<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="colorlib.com">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sign Up Form</title>

    <link rel="stylesheet" href="fonts/material-icon/css/material-design-iconic-font.min.css">

    <link rel="stylesheet" href="css/registerstyle.css">

    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>


    <script src="vendor/jquery/jquery-3.2.1.min.js"></script>

    <script>
        // if (4 == 1) {

        //     firstname = document.getElementById("first_name").value;
        //     lastname = document.getElementById("last_name").value;
        //     username = document.getElementById("username").value;
        // } else if (4 == 2) {
        //     password = document.getElementById("password").value;
        //     phone = document.getElementById("phoneNumber").value;
        //     age = document.getElementById("age").value;
        // }

        function isempty() {
            let empty = true;

        }
        let firstname = ""
        let username = ""
        let lastname = ""
        let phone = ""
        let password = ""
        let email = ""
        let age = ""

        var firebaseConfig = {
            apiKey: "AIzaSyBBe_h_aIgSRbT-xwXhlGkSmbUB2zmZGNc",
            authDomain: "huluradiox.firebaseapp.com",
            databaseURL: "https://huluradiox.firebaseio.com",
            projectId: "huluradiox",
            storageBucket: "huluradiox.appspot.com",
            messagingSenderId: "701196878506",
            appId: "1:701196878506:web:09e72de08f77c460ac46d3",
            measurementId: "G-Y50XR144GX"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        function init() {

            window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('sendCode', {
                'size': 'invisible',
                'callback': function(recaptchaToken) {
                    // reCAPTCHA solved, send recaptchaToken and phone number to backend.

                    // a REST call to your backend
                    console.dir({
                        phoneNumber: document.getElementById('phoneNumber').value,
                        recaptchaToken
                    })

                    var myHeaders = new Headers();
                    myHeaders.append('Content-Type', 'application/json');


                    console.log("this is the file")
                        // $.post("https://afrigebeta.herokuapp.com/api/user/sendCode", {
                        //     phoneNumber: document.getElementById('phoneNumber').value,
                        //     recaptchaToken: recaptchaToken
                        // }, function(data, status) {

                    //     if (status === 'success') {
                    //         alert("hi")
                    //     }
                    // }).fail(function(jqXHR, textStatus, errorThrown) {

                    //     console.log(jqXHR)
                    // });


                }
            });



            function sendOTP() {
                const sessionId = window.sessionId
                const otp = document.getElementById("otp_input").value

                fetch("http://localhost:3000/api/user/acceptOTP", {
                        method: "post",
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        mode: 'cors',
                        cache: 'no-cache',
                        body: JSON.stringify({
                            code: otp,
                            sessionInfo: sessionId
                        })
                    })
                    .then(response => response.json())
                    .then(res => {
                        console.dir(res)
                            // TODO: Well some kind of success or error 
                    });
            }

            // render the rapchaVerifier. 
            window.recaptchaVerifier.render().then(function(widgetId) {
                window.recaptchaWidgetId = widgetId;
            });
        }


        $(document).ready(function() {

            let t = ""
            t = t + " <fieldset>"
            t = t + "   <div class=\"form-row\">"
            t = t + "       <div class=\"form-file\">"
            t = t + "           <input type=\"file\" class=\"inputfile\" name=\"your_picture\" id=\"your_picture\" onchange=\"readURL(this);\" data-multiple-caption=\"{count} files selected\" multiple />"
            t = t + "           <label for=\"your_picture\">"
            t = t + "           <figure>"
            t = t + "               <img src=\"images/your-picture.png\" alt=\"\" class=\"your_picture_image\">"
            t = t + "           </figure>"

            t = t + "       </label>"
            t = t + "   </div>"
            t = t + " <div class=\"form-group-flex\">"
            t = t + "     <div class=\"form-group\">"
            t = t + "         <input type=\"text\" name=\"first_name\" id=\"first_name\" placeholder=\"First Name\" />"
            t = t + "     </div>"
            t = t + "    <div class=\"form-group\">"
            t = t + "        <input type=\"text\" name=\"last_name\" id=\"last_name\" placeholder=\"Last Name\" />"
            t = t + "    </div>"
            t = t + "    <div class=\"form-group\">"
            t = t + "        <input type=\"text\" name=\"username\" id=\"username\" placeholder=\"username\" />"
            t = t + "    </div>"
            t = t + " <div class=\"form-group\">"
            t = t + "     <input type=\"text\" name=\"city\" id=\"city\" placeholder=\"City\" />"
            t = t + "  </div>"
            t = t + "  <div class=\"form-group\">"
            t = t + "      <input type=\"text\" name=\"phone\" id=\"phoneNumber\" placeholder=\"phone\" />"
            t = t + "   </div>"
            t = t + "   <div class=\"form-group\">"
            t = t + "       <input type=\"text\" name=\"age\" id=\"age\" placeholder=\"age\" />"
            t = t + "   </div>"

            t = t + "   <div class=\"form-group\">"
            t = t + "       <input type=\"text\" name=\"password\" id=\"password\" placeholder=\"password\" />"
            t = t + "   </div>"
            t = t + "  </div>"
            t = t + "</div>"
            t = t + " </fieldset>"


            $('.formposition').append(t)

            function isEmpty(str) {
                return (!str || /^\s*$/.test(str));
            }

            function validatePhone(value) {
                var re = /^[0-9]{10}$/;
                var re2 = /^[0-9,+]{13}$/;
                var re3 = /^251[0-9]{9}$/;
                if (value.match(re) || value.match(re2) || value.match(re3)) return true;
                else return false
            }

            function validateAge(value) {
                var re = /^\d+$/;
                if (value.match(re)) return true;
                else return false
            }


            $("input[type='text']").on("input", function() {

                // if (currentIndex == 1) {

                //     firstname = document.getElementById("first_name").value;
                //     lastname = document.getElementById("last_name").value;
                //     username = document.getElementById("username").value;
                // } else if (currentIndex == 2) {
                //     password = document.getElementById("password").value;
                //     phone = document.getElementById("phoneNumber").value;
                //     age = document.getElementById("age").value;
                // }
                function change_placeholder_color(target_class, color_choice) {
                    $("body").append("<style>" + target_class + "::placeholder{color:" + color_choice + "}</style>")
                }


                if (isEmpty(document.getElementById("first_name").value) == false &&
                    isEmpty(document.getElementById("last_name").value) == false &&
                    isEmpty(document.getElementById("username").value) == false &&
                    isEmpty(document.getElementById("password").value) == false &&
                    isEmpty(document.getElementById("phoneNumber").value) == false &&
                    isEmpty(document.getElementById("city").value) == false &&
                    isEmpty(document.getElementById("age").value) == false) {
                    if (validatePhone(document.getElementById("phoneNumber").value) == true && validateAge(document.getElementById("age").value) == true) {
                        //now disable the button

                        document.getElementById("sendCode").disabled = false;

                    } else {


                        document.getElementById("sendCode").disabled = true;
                    }
                } else {
                    document.getElementById("sendCode").disabled = true;
                }
            });



        })

        function signup() {
            alert("signup")
        }

        function next() {

            $('.formposition').empty()
            let t = ""
            t = t + " <fieldset>"
            t = t + "   <div class=\"form-row\">"
            t = t + "       <div class=\"form-file\">"
            t = t + "           <input type=\"file\" class=\"inputfile\" name=\"your_picture\" id=\"your_picture\" onchange=\"readURL(this);\" data-multiple-caption=\"{count} files selected\" multiple />"
            t = t + "           <label for=\"your_picture\">"
            t = t + "           <figure>"
            t = t + "               <img src=\"images/your-picture.png\" alt=\"\" class=\"your_picture_image\">"
            t = t + "           </figure>"

            t = t + "       </label>"
            t = t + "   </div>"
            t = t + " <div class=\"form-group-flex\">"
            t = t + "     <div class=\"form-group\">"
            t = t + "         <input type=\"text\" name=\"code\" id=\"code\" placeholder=\"Code\" />"
            t = t + "     </div>"

            t = t + "  </div>"
            t = t + "</div>"
            t = t + " </fieldset>"
            t = t + "<button onclick=\"signup()\">Sign Up</button>"

            $('.formposition').append(t)
        }
    </script>

</head>

<body onload="init()">
    <div id="re-container"></div>

    <div class="main">

        <div class="container">
            <h2>Build your profile</h2>
            <div class="formposition"></div>
            <button id="sendCode" disabled onclick="next()">Next</button>"
        </div>

    </div>

    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="vendor/jquery-validation/dist/additional-methods.min.js"></script>

</body>

</html>